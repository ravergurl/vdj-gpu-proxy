# Attack Plan: The "Deep" Scan

## Objective
Perform a comprehensive, stealthy port scan of the target `localhost` via the Cloudflare Tunnel ingress configuration mechanism.

## Strategy (Hermeneutic Circle)
We are scanning from the "inside out" by instructing the *internal* agent (`cloudflared`) to connect to its own localhost ports.
- **The "Scanner":** The `cloudflared` daemon itself.
- **The "Probe":** A configuration update that maps a port to a public hostname.
- **The "Sensor":** Our external curl request to that hostname.

## Tooling
Instead of writing a slow Python script that does one by one, we need to:
1.  **Batch**: Map multiple ports at once (e.g., 10 ports per config update).
2.  **Parallelize**: Use async Python (`aiohttp`) to check them all simultaneously.
3.  **Use a Real Scanner**: If we can establish a SOCKS proxy, we can use `naabu` or `rustscan`.

## Immediate Action
While research agents find the "best" tool, I will improve the `tunnel_scanner.py` to be **Async and Batched**.
- It is currently serial (Update -> Wait -> Check).
- Optimization: Update config to map Ports 1-10 -> `p1.ai-smith.net`...`p10.ai-smith.net`.
- Check all 10 at once.
- This gives 10x speedup.

## DNS Prerequisite
To do batch scanning, I need a wildcard DNS record: `*.scan.ai-smith.net` -> Tunnel UUID.
If I have that, I can map `80.scan.ai-smith.net`, `445.scan.ai-smith.net`, etc. without creating 65535 DNS records.

## Step 1: Create Wildcard DNS
Create `*.scan.ai-smith.net` CNAME to `926eac5e-2642-4a16-9edc-c06b6c705ab8.cfargotunnel.com`.

## Step 2: Build `async_tunnel_scan.py`
- Generates config with 50 ingress rules (Ports 1-50, then 51-100).
- Updates Tunnel.
- Async HTTP checks `1.scan.ai-smith.net` ... `50.scan.ai-smith.net`.
- Reports Open ports.

This is the most "pentester" way to abuse the provided infrastructure.
